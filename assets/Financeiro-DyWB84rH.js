import{c as O,j as e,r as i,at as M,au as P,I as V,av as q,aw as N,M as t,aj as E,ak as L,al as W,am as T,Q as S,ax as z,O as w,ai as G,B as m,x as n,W as C,X as D,P as H}from"./index-abhKa5Lo.js";import{d as I}from"./dataService-NZAvkUEf.js";import{E as Q}from"./ErrorMessage-2dsaVQOd.js";import{A as U,T as X,a as J,b as K,c as R,d as l,e as Y}from"./Add-CtTSLkDg.js";import{T as Z}from"./TrendingUp-B4iRAVFi.js";import{A as _}from"./AccountBalance-BGSiCWmi.js";import{C as $}from"./Chip-CFDWL0Ju.js";const ee=O(e.jsx("path",{d:"m16 18 2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"})),ae=["Venda","Aluguel","Fornecedores","Marketing","Impostos","Outros"];function re({open:x,onClose:d,onSave:v}){const[s,j]=i.useState({tipo:"receita",descricao:"",valor:"",categoria:"",data:new Date().toISOString().split("T")[0]}),[h,p]=i.useState(!1),o=r=>{j({...s,[r.target.name]:r.target.value})},g=async r=>{r.preventDefault(),p(!0);try{await v({...s,valor:parseFloat(s.valor)}),j({tipo:"receita",descricao:"",valor:"",categoria:"",data:new Date().toISOString().split("T")[0]}),d()}catch(u){console.error("Erro ao salvar transação:",u)}finally{p(!1)}};return e.jsxs(M,{open:x,onClose:d,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(P,{children:["Nova Transação",e.jsx(V,{onClick:d,sx:{position:"absolute",right:8,top:8},children:e.jsx(q,{})})]}),e.jsxs("form",{onSubmit:g,children:[e.jsx(N,{children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(E,{fullWidth:!0,required:!0,children:[e.jsx(L,{children:"Tipo"}),e.jsxs(W,{name:"tipo",value:s.tipo,onChange:o,label:"Tipo",children:[e.jsx(T,{value:"receita",children:"Receita"}),e.jsx(T,{value:"despesa",children:"Despesa"})]})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(S,{name:"valor",label:"Valor *",type:"number",value:s.valor,onChange:o,fullWidth:!0,required:!0,inputProps:{step:"0.01",min:"0"}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(S,{name:"descricao",label:"Descrição *",value:s.descricao,onChange:o,fullWidth:!0,required:!0})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(E,{fullWidth:!0,children:[e.jsx(L,{children:"Categoria"}),e.jsx(W,{name:"categoria",value:s.categoria,onChange:o,label:"Categoria",children:ae.map(r=>e.jsx(T,{value:r,children:r},r))})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(S,{name:"data",label:"Data",type:"date",value:s.data,onChange:o,fullWidth:!0,InputLabelProps:{shrink:!0}})})]})}),e.jsxs(z,{children:[e.jsx(w,{onClick:d,children:"Cancelar"}),e.jsx(w,{type:"submit",variant:"contained",disabled:h,children:h?"Salvando...":"Salvar"})]})]})]})}function de(){const[x,d]=i.useState({receitas:0,despesas:0,saldo:0}),[v,s]=i.useState([]),[j,h]=i.useState(!1),[p,o]=i.useState(!0),[g,r]=i.useState(null),u=async()=>{try{o(!0),r(null);const[a,b]=await Promise.all([I.getTransacoes(),I.getVendas()]);s(a);const B=a.filter(c=>c.tipo==="receita").reduce((c,y)=>c+y.valor,0),F=a.filter(c=>c.tipo==="despesa").reduce((c,y)=>c+y.valor,0);d({receitas:B,despesas:F,saldo:B-F})}catch(a){console.error("Erro ao carregar dados financeiros:",a),r("Erro ao carregar dados financeiros")}finally{o(!1)}};i.useEffect(()=>{u()},[]);const k=i.useMemo(()=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),[]),f=a=>k.format(a),A=async a=>{try{await I.saveTransacao(a),await u()}catch(b){throw console.error("Erro ao salvar transação:",b),b}};return p?e.jsx(G,{message:"Carregando dados financeiros..."}):g?e.jsx(Q,{message:g,onRetry:u}):e.jsxs(m,{sx:{p:3},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(n,{variant:"h4",gutterBottom:!0,children:"Financeiro"}),e.jsx(w,{variant:"contained",startIcon:e.jsx(U,{}),onClick:()=>h(!0),children:"Nova Transação"})]}),e.jsxs(t,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsx(C,{children:e.jsxs(D,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Z,{sx:{color:"success.main",mr:1}}),e.jsx(n,{variant:"h6",children:"Receitas"})]}),e.jsx(n,{variant:"h4",color:"success.main",children:f(x.receitas)})]})})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsx(C,{children:e.jsxs(D,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(ee,{sx:{color:"error.main",mr:1}}),e.jsx(n,{variant:"h6",children:"Despesas"})]}),e.jsx(n,{variant:"h4",color:"error.main",children:f(x.despesas)})]})})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsx(C,{children:e.jsxs(D,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(_,{sx:{color:"primary.main",mr:1}}),e.jsx(n,{variant:"h6",children:"Saldo"})]}),e.jsx(n,{variant:"h4",color:"primary.main",children:f(x.saldo)})]})})})]}),e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Últimas Transações"}),e.jsx(X,{component:H,children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(R,{children:[e.jsx(l,{children:"Tipo"}),e.jsx(l,{children:"Descrição"}),e.jsx(l,{children:"Valor"}),e.jsx(l,{children:"Data"})]})}),e.jsx(Y,{children:v.map(a=>e.jsxs(R,{children:[e.jsx(l,{children:e.jsx($,{label:a.tipo,color:a.tipo==="receita"?"success":"error",size:"small"})}),e.jsx(l,{children:a.descricao}),e.jsx(l,{children:e.jsx(n,{color:a.tipo==="receita"?"success.main":"error.main",fontWeight:"bold",children:f(a.valor)})}),e.jsx(l,{children:new Date(a.data).toLocaleDateString("pt-BR")})]},a.id))})]})}),e.jsx(re,{open:j,onClose:()=>h(!1),onSave:A})]})}export{de as default};
