import{r as c,a6 as A,j as e,B as i,x as r,O as y,P as B,M as x,aj as w,ak as F,al as W,am as b,Q as k,I as U,an as X,ao as Y,ap as q}from"./index-PaSrWoMO.js";import{d as I}from"./dataService-NZAvkUEf.js";import{A as M,T as z,a as N,b as O,c as g,d as n,e as Q}from"./Add-BdT2T434.js";import{V as Z,D as _}from"./Visibility-BgGw4kRs.js";import{T as ee}from"./Toast-BSOj2GBC.js";import{C as te}from"./Chip-dY3oWvxn.js";function ae(){const[p,C]=c.useState([]),[o,P]=c.useState([]),[T,m]=c.useState(!0),[h,v]=c.useState({}),D=A();c.useEffect(()=>{(async()=>{try{m(!0);const[j,E]=await Promise.all([I.getVendas(),I.getClientes()]);C(j),P(E)}catch(j){console.error("Erro ao carregar dados:",j)}finally{m(!1)}})()},[]);const S=async()=>{try{m(!0);const t=await I.getVendas(h);C(t)}catch(t){console.error("Erro ao filtrar vendas:",t)}finally{m(!1)}},V=async()=>{v({});try{m(!0);const t=await I.getVendas();C(t)}catch(t){console.error("Erro ao limpar filtros:",t)}finally{m(!1)}},d=t=>new Date(t).toLocaleDateString("pt-BR"),l=t=>t.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),s=t=>{switch(t){case"pago":return"success.main";case"pendente":return"warning.main";case"cancelado":return"error.main";default:return"text.primary"}};return e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendas"}),e.jsx(y,{variant:"contained",color:"primary",startIcon:e.jsx(M,{}),onClick:()=>D("/vendas/nova"),children:"Nova Venda"})]}),e.jsxs(B,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Filtros"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(F,{id:"cliente-label",children:"Cliente"}),e.jsxs(W,{labelId:"cliente-label",value:h.clienteId||"",label:"Cliente",onChange:t=>v({...h,clienteId:t.target.value}),children:[e.jsx(b,{value:"",children:"Todos"}),o.map(t=>e.jsx(b,{value:t.id,children:t.nome},t.id))]})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(k,{label:"Data Início",type:"date",size:"small",fullWidth:!0,InputLabelProps:{shrink:!0},value:h.dataInicio||"",onChange:t=>v({...h,dataInicio:t.target.value})})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(k,{label:"Data Fim",type:"date",size:"small",fullWidth:!0,InputLabelProps:{shrink:!0},value:h.dataFim||"",onChange:t=>v({...h,dataFim:t.target.value})})}),e.jsx(x,{item:!0,xs:12,md:2,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(F,{id:"status-label",children:"Status"}),e.jsxs(W,{labelId:"status-label",value:h.status||"",label:"Status",onChange:t=>v({...h,status:t.target.value}),children:[e.jsx(b,{value:"",children:"Todos"}),e.jsx(b,{value:"pendente",children:"Pendente"}),e.jsx(b,{value:"pago",children:"Pago"}),e.jsx(b,{value:"cancelado",children:"Cancelado"})]})]})})]}),e.jsxs(i,{sx:{mt:2,display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(y,{variant:"outlined",onClick:V,children:"Limpar"}),e.jsx(y,{variant:"contained",onClick:S,children:"Filtrar"})]})]}),e.jsx(z,{component:B,children:e.jsxs(N,{children:[e.jsx(O,{children:e.jsxs(g,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Cliente"}),e.jsx(n,{children:"Data"}),e.jsx(n,{children:"Valor Total"}),e.jsx(n,{children:"Status"}),e.jsx(n,{align:"center",children:"Ações"})]})}),e.jsx(Q,{children:T?e.jsx(g,{children:e.jsx(n,{colSpan:6,align:"center",children:"Carregando..."})}):p.length===0?e.jsx(g,{children:e.jsx(n,{colSpan:6,align:"center",children:"Nenhuma venda encontrada"})}):p.map(t=>e.jsxs(g,{children:[e.jsx(n,{children:t.id}),e.jsx(n,{children:t.cliente.nome}),e.jsx(n,{children:d(t.data)}),e.jsx(n,{children:l(t.total)}),e.jsx(n,{children:e.jsx(i,{component:"span",sx:{color:s(t.status),fontWeight:"bold",textTransform:"capitalize"},children:t.status})}),e.jsx(n,{align:"center",children:e.jsx(U,{color:"primary",onClick:()=>D(`/vendas/${t.id}`),children:e.jsx(Z,{})})})]},t.id))})]})})]})}function ne(){const p=A(),[C,o]=c.useState([]),[P,T]=c.useState([]),[m,h]=c.useState([]),[v,D]=c.useState(!0),[S,V]=c.useState(!1),[d,l]=c.useState({open:!1,message:"",severity:"success"}),[s,t]=c.useState({clienteId:"",itens:[],formaPagamentoId:"",data:new Date().toISOString().split("T")[0],observacoes:""}),[j,E]=c.useState({produtoId:"",quantidade:1});c.useEffect(()=>{(async()=>{try{D(!0);const[u,f,L]=await Promise.all([I.getClientes(),I.getProdutos(),I.getFormasPagamento()]);o(u),T(f),h(L)}catch(u){console.error("Erro ao carregar dados:",u),l({open:!0,message:"Erro ao carregar dados. Tente novamente.",severity:"error"})}finally{D(!1)}})()},[]);const $=()=>{if(!j.produtoId||j.quantidade<=0){l({open:!0,message:"Selecione um produto e quantidade válida",severity:"error"});return}const a=s.itens.findIndex(u=>u.produtoId===j.produtoId);if(a>=0){const u=[...s.itens];u[a].quantidade+=j.quantidade,t({...s,itens:u})}else t({...s,itens:[...s.itens,{...j}]});E({produtoId:"",quantidade:1})},G=a=>{const u=[...s.itens];u.splice(a,1),t({...s,itens:u})},H=()=>s.itens.reduce((a,u)=>{const f=P.find(L=>L.id===u.produtoId);return a+(f?f.preco*u.quantidade:0)},0),R=a=>a.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),J=async()=>{if(!s.clienteId){l({open:!0,message:"Selecione um cliente",severity:"error"});return}if(s.itens.length===0){l({open:!0,message:"Adicione pelo menos um produto",severity:"error"});return}if(!s.formaPagamentoId){l({open:!0,message:"Selecione uma forma de pagamento",severity:"error"});return}try{V(!0),await I.saveVenda(s),l({open:!0,message:"Venda cadastrada com sucesso!",severity:"success"}),setTimeout(()=>{p("/vendas")},1500)}catch(a){console.error("Erro ao salvar venda:",a),l({open:!0,message:"Erro ao salvar venda. Tente novamente.",severity:"error"})}finally{V(!1)}};return v?e.jsx(i,{sx:{p:3,textAlign:"center"},children:e.jsx(r,{children:"Carregando..."})}):e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"Nova Venda"}),e.jsx(y,{variant:"outlined",onClick:()=>p("/vendas"),children:"Voltar"})]}),e.jsxs(B,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Informações da Venda"}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(w,{fullWidth:!0,children:[e.jsx(F,{id:"cliente-label",children:"Cliente *"}),e.jsx(W,{labelId:"cliente-label",value:s.clienteId,label:"Cliente *",onChange:a=>t({...s,clienteId:a.target.value}),children:C.map(a=>e.jsxs(b,{value:a.id,children:[a.nome," ",a.empresa?`(${a.empresa})`:""]},a.id))})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(w,{fullWidth:!0,children:[e.jsx(F,{id:"pagamento-label",children:"Forma de Pagamento *"}),e.jsx(W,{labelId:"pagamento-label",value:s.formaPagamentoId,label:"Forma de Pagamento *",onChange:a=>t({...s,formaPagamentoId:a.target.value}),children:m.map(a=>e.jsx(b,{value:a.id,children:a.nome},a.id))})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(k,{label:"Data",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:s.data,onChange:a=>t({...s,data:a.target.value})})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(k,{label:"Observações",multiline:!0,rows:2,fullWidth:!0,value:s.observacoes||"",onChange:a=>t({...s,observacoes:a.target.value})})})]})]}),e.jsxs(B,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Produtos"}),e.jsxs(x,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(F,{id:"produto-label",children:"Produto"}),e.jsx(W,{labelId:"produto-label",value:j.produtoId,label:"Produto",onChange:a=>E({...j,produtoId:a.target.value}),children:P.map(a=>e.jsxs(b,{value:a.id,children:[a.nome," - ",R(a.preco)]},a.id))})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(k,{label:"Quantidade",type:"number",size:"small",fullWidth:!0,value:j.quantidade,onChange:a=>E({...j,quantidade:parseInt(a.target.value)||0}),InputProps:{inputProps:{min:1}}})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(y,{variant:"contained",startIcon:e.jsx(M,{}),onClick:$,fullWidth:!0,children:"Adicionar"})})]}),e.jsx(z,{children:e.jsxs(N,{children:[e.jsx(O,{children:e.jsxs(g,{children:[e.jsx(n,{children:"Produto"}),e.jsx(n,{align:"center",children:"Quantidade"}),e.jsx(n,{align:"right",children:"Preço Unit."}),e.jsx(n,{align:"right",children:"Subtotal"}),e.jsx(n,{align:"center",children:"Ações"})]})}),e.jsxs(Q,{children:[s.itens.length===0?e.jsx(g,{children:e.jsx(n,{colSpan:5,align:"center",children:"Nenhum produto adicionado"})}):s.itens.map((a,u)=>{const f=P.find(K=>K.id===a.produtoId);if(!f)return null;const L=f.preco*a.quantidade;return e.jsxs(g,{children:[e.jsx(n,{children:f.nome}),e.jsx(n,{align:"center",children:a.quantidade}),e.jsx(n,{align:"right",children:R(f.preco)}),e.jsx(n,{align:"right",children:R(L)}),e.jsx(n,{align:"center",children:e.jsx(U,{color:"error",onClick:()=>G(u),children:e.jsx(_,{})})})]},u)}),e.jsxs(g,{children:[e.jsx(n,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Total:"}),e.jsx(n,{align:"right",sx:{fontWeight:"bold"},children:R(H())}),e.jsx(n,{})]})]})]})})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(y,{variant:"outlined",onClick:()=>p("/vendas"),children:"Cancelar"}),e.jsx(y,{variant:"contained",color:"primary",onClick:J,disabled:S,children:S?"Salvando...":"Salvar Venda"})]}),e.jsx(ee,{open:d.open,onClose:()=>l({...d,open:!1}),message:d.message,severity:d.severity})]})}function re(){const{id:p}=X(),C=A(),[o,P]=c.useState(null),[T,m]=c.useState(!0),[h,v]=c.useState(null);c.useEffect(()=>{(async()=>{if(p)try{m(!0);const l=await I.getVendaById(p);if(!l){v("Venda não encontrada");return}P(l)}catch(l){console.error("Erro ao carregar venda:",l),v("Erro ao carregar dados da venda")}finally{m(!1)}})()},[p]);const D=d=>{const l=new Date(d);return l.toLocaleDateString("pt-BR")+" "+l.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})},S=d=>d.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),V=d=>{switch(d){case"pago":return"success";case"pendente":return"warning";case"cancelado":return"error";default:return"default"}};return T?e.jsx(i,{sx:{p:3,textAlign:"center"},children:e.jsx(r,{children:"Carregando..."})}):h||!o?e.jsxs(i,{sx:{p:3},children:[e.jsx(r,{color:"error",gutterBottom:!0,children:h||"Erro desconhecido"}),e.jsx(y,{variant:"contained",onClick:()=>C("/vendas"),children:"Voltar para Vendas"})]}):e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{variant:"h4",component:"h1",gutterBottom:!0,children:["Detalhes da Venda #",o.id]}),e.jsx(y,{variant:"outlined",onClick:()=>C("/vendas"),children:"Voltar"})]}),e.jsx(B,{sx:{p:3,mb:4},children:e.jsxs(x,{container:!0,spacing:3,children:[e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Informações da Venda"}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Status"}),e.jsx(te,{label:o.status.toUpperCase(),color:V(o.status),sx:{mt:.5}})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Data"}),e.jsx(r,{variant:"body1",children:D(o.data)})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Forma de Pagamento"}),e.jsx(r,{variant:"body1",children:o.formaPagamento.nome})]}),o.observacoes&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Observações"}),e.jsx(r,{variant:"body1",children:o.observacoes})]})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Informações do Cliente"}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Nome"}),e.jsx(r,{variant:"body1",children:o.cliente.nome})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Email"}),e.jsx(r,{variant:"body1",children:o.cliente.email})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Telefone"}),e.jsx(r,{variant:"body1",children:o.cliente.telefone})]}),o.cliente.empresa&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Empresa"}),e.jsx(r,{variant:"body1",children:o.cliente.empresa})]})]})]})}),e.jsxs(B,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Produtos"}),e.jsx(z,{children:e.jsxs(N,{children:[e.jsx(O,{children:e.jsxs(g,{children:[e.jsx(n,{children:"Produto"}),e.jsx(n,{align:"center",children:"Quantidade"}),e.jsx(n,{align:"right",children:"Preço Unit."}),e.jsx(n,{align:"right",children:"Subtotal"})]})}),e.jsxs(Q,{children:[o.itens.map((d,l)=>e.jsxs(g,{children:[e.jsx(n,{children:d.produto.nome}),e.jsx(n,{align:"center",children:d.quantidade}),e.jsx(n,{align:"right",children:S(d.precoUnitario)}),e.jsx(n,{align:"right",children:S(d.subtotal)})]},l)),e.jsxs(g,{children:[e.jsx(n,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Total:"}),e.jsx(n,{align:"right",sx:{fontWeight:"bold"},children:S(o.total)})]})]})]})})]})]})}function se(){return e.jsxs(Y,{children:[e.jsx(q,{index:!0,element:e.jsx(ae,{})}),e.jsx(q,{path:"nova",element:e.jsx(ne,{})}),e.jsx(q,{path:":id",element:e.jsx(re,{})})]})}function xe(){return e.jsx(se,{})}export{xe as default};
